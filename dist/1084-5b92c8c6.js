"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[1084],{31084:(e,t,a)=>{a.d(t,{BigCommercePaymentsAPMsPaymentMethod:()=>C,BigCommercePaymentsButton:()=>s,BigCommercePaymentsCreditCardsPaymentMethod:()=>B,BigCommercePaymentsFastlanePaymentMethod:()=>q,BigCommercePaymentsPayLaterPaymentMethod:()=>$,BigCommercePaymentsPaymentMethod:()=>_,BigCommercePaymentsRatePayPaymentMethod:()=>ae,BigCommercePaymentsVenmoPaymentMethod:()=>Y,BigcommercePaymentsPayLaterButton:()=>K});var n=a(7991),r=a(70355),i=a(63582),o=a(19285),c=a(4907);const s=(0,o.A)((e=>{const t={onComplete:c.A,onError:e.onUnhandledError};return r.createElement(i.A,Object.assign({additionalInitializationOptions:t,integrations:[n.ae]},e))}),[{id:"bigcommerce_payments"}]);var d=a(31635),m=a(11474),l=a(40646),u=a(48447),y=a(91182);const p=({method:e,checkoutService:t,paymentForm:a,onUnhandledError:n,providerOptionsKey:i,providerOptionsData:o,children:c,currentInstrument:s,language:m,shouldConfirmInstrument:l})=>{const u=(0,r.useRef)(null),y=(0,r.useRef)(null),p=(0,r.useRef)(null),h=(0,r.useRef)(!1),g=a.getFieldValue("terms"),b=a.getFieldValue("shouldSaveInstrument"),f=()=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){const e=yield a.validateForm();return Object.keys(e)})),v=()=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){if(!u.current)return;(yield f()).length?u.current.disable():u.current.enable()})),_=(0,r.useCallback)((()=>{s&&!l?(a.hidePaymentSubmitButton(e,!1),h.current=!1):!h.current&&p.current&&(a.hidePaymentSubmitButton(e,!0),setTimeout((()=>{var e;null===(e=p.current)||void 0===e||e.call(p),h.current=!0}),0))}),[s]);(0,r.useEffect)((()=>{_()}),[_,p.current]),(0,r.useEffect)((()=>{v()}),[g]),(0,r.useEffect)((()=>{y.current={shouldSaveInstrument:l||Boolean(b)}}),[b,l]);return(0,r.useEffect)((()=>((0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,[i]:Object.assign({container:"#checkout-payment-continue",shouldRenderPayPalButtonOnInitialization:!1,onRenderButton:()=>{a.hidePaymentSubmitButton(e,!0)},onInit:e=>{p.current=e},submitForm:()=>{a.setSubmitted(!0),a.submitForm()},onError:t=>{a.disableSubmit(e,!0),"INSTRUMENT_DECLINED"===t.message?n(new Error(m.translate("payment.errors.instrument_declined"))):n(t)},onValidate:(e,t)=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){const n=yield f();return n.length?(a.setSubmitted(!0),n.forEach((e=>a.setFieldTouched(e))),t()):e()})),onInitButton:e=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){u.current=e,yield v()})),getFieldsValues:()=>y.current},o||{})})}catch(e){e instanceof Error&&n(e)}})),()=>{(0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&n(e)}}))})),[]),c?r.createElement(r.Fragment,null,c):r.createElement(r.Fragment,null)};var h=a(69440),g=a(65685),b=a(39981),f=a(66960);const v=e=>{const[t,a]=(0,r.useState)(),{checkoutState:n}=(0,b.Q)(),i=n.data.getCustomer(),o=n.data.getInstruments(e)||[],{paymentForm:c}=(0,f.N)(),{setFieldValue:s}=c,d=(0,r.useMemo)((()=>o.filter(g.A)),[o]),m=(0,r.useMemo)((()=>d.filter((e=>e.trustedShippingAddress))),[d]),l=d.length>0,u=!(null==i?void 0:i.isGuest)&&Boolean(e.config.isVaultingEnabled)&&!e.initializationData.isComplete,y=u&&l,p=y&&!t,v=y&&!!t&&!m.length;(0,r.useEffect)((()=>{a(u?(()=>{if(!m.length)return;return m.filter((({defaultInstrument:e})=>e))[0]||m[0]})():void 0)}),[u,m]),(0,r.useEffect)((()=>{y||s("instrumentId","")}),[s,y]);const _=(0,r.useCallback)((e=>{a((0,h.find)(m,{bigpayToken:e})),s("instrumentId",e),s("shouldSetAsDefaultInstrument",!1)}),[m,s]),E=(0,r.useCallback)((()=>{a(void 0),s("instrumentId",""),s("shouldSaveInstrument",!1),s("shouldSetAsDefaultInstrument",!1)}),[s]);return{trustedAccountInstruments:m,currentInstrument:t,handleSelectInstrument:_,handleUseNewInstrument:E,isInstrumentFeatureAvailable:u,shouldShowInstrumentFieldset:y,shouldCreateNewInstrument:p,shouldConfirmInstrument:v}},_=(0,o.A)((e=>{const{checkoutState:{data:{isPaymentDataRequired:t,getCustomer:a,getInstruments:n},statuses:{isLoadingInstruments:i,isLoadingPaymentMethod:o}}}=e,c=e.method,{config:{isVaultingEnabled:s}}=c,h=(0,d.__rest)(c.initializationData,[]),{method:g,checkoutService:b,onUnhandledError:f}=e,{trustedAccountInstruments:_,currentInstrument:E,handleSelectInstrument:C,handleUseNewInstrument:I,isInstrumentFeatureAvailable:P,shouldShowInstrumentFieldset:S,shouldConfirmInstrument:A}=v(g);if((0,r.useEffect)((()=>{const{isGuest:e}=a()||{};!e&&s&&!h&&(0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield b.loadInstruments()}catch(e){e instanceof Error&&f(e)}}))})),!t())return null;const w=i()||o(g.id),k=n()||[];return r.createElement(y.A,{hideContentWhenLoading:!0,isLoading:w},r.createElement(p,Object.assign({currentInstrument:E,providerOptionsKey:"bigcommerce_payments",shouldConfirmInstrument:A},e),S&&r.createElement(m.A,{instruments:_,onSelectInstrument:C,onUseNewInstrument:I,selectedInstrument:E}),A&&r.createElement("div",null,r.createElement(u.A,{id:"payment.account_instrument_new_shipping_address"})),P&&r.createElement(l.A,{instrumentId:null==E?void 0:E.bigpayToken,instruments:k,isAccountInstrument:!0})))}),[{id:"bigcommerce_payments"}]);var E=a(29345);const C=(0,o.A)((e=>{const{method:t,checkoutState:a}=e;if(!a.data.isPaymentDataRequired())return null;const n=(0,E.A)(t.id,t.gateway),i={apmFieldsContainer:`#${n}`,apmFieldsStyles:{variables:{fontFamily:"Open Sans, Helvetica Neue, Arial, sans-serif",colorBackground:"transparent",textColor:"black",fontSizeBase:"16px",spacingUnit:"1rem",borderColor:"#d9d9d9",borderRadius:"4px",borderWidth:"1px"},rules:{".Input":{backgroundColor:"white",color:"#333",fontSize:"1rem"},".Input:active":{color:"#4496f6"},".Input--invalid":{color:"#ed6a6a"}}}};return r.createElement(p,Object.assign({providerOptionsData:i,providerOptionsKey:"bigcommerce_payments_apms"},e),r.createElement("div",{className:`widget widget--${t.id} payment-widget`,id:n}))}),[{gateway:"bigcommerce_payments_apms"}]);var I=a(14527),P=a(98363),S=a(27883),A=a(35781),w=a(66833),k=a(48407),F=a(31448),N=a(82804),T=a(53783);const B=(0,o.A)((e=>{const{checkoutService:t,checkoutState:a,paymentForm:n,language:i,method:o}=e,{cardCode:c,showCardHolderName:s,isHostedFormEnabled:m,requireCustomerCode:l}=o.config,[u,y]=(0,r.useState)(),{setFieldTouched:p,setFieldValue:g,setSubmitted:b,submitForm:f}=n,v=(0,k.A)(a),_=(0,F.A)(a),E=c||null===c,C=null==s||s,B=(0,r.useCallback)((e=>`${(0,h.compact)([o.gateway,o.id]).join("-")}-${e}`),[o]),O=(0,r.useCallback)((e=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){const t=["color","fontFamily","fontSize","fontWeight"],a=!!e&&_(e,o),n=!!e&&v(e,o),r=a||n;let c;return e&&r&&(c=B("ccCvv")),e||(c=B("ccNumber")),{fields:e?{cardCodeVerification:r?{accessibilityLabel:i.translate("payment.credit_card_cvv_label"),containerId:B("ccCvv"),instrumentId:e.bigpayToken}:void 0,cardNumberVerification:r?{accessibilityLabel:i.translate("payment.credit_card_number_label"),containerId:B("ccNumber"),instrumentId:e.bigpayToken}:void 0,cardExpiryVerification:r?{accessibilityLabel:i.translate("payment.credit_card_expiry_label"),containerId:B("ccExpiry"),instrumentId:e.bigpayToken}:void 0}:{cardCode:E?{accessibilityLabel:i.translate("payment.credit_card_cvv_label"),containerId:B("ccCvv")}:void 0,cardExpiry:{accessibilityLabel:i.translate("payment.credit_card_expiration_label"),containerId:B("ccExpiry"),placeholder:i.translate("payment.credit_card_expiration_placeholder_text")},cardName:{accessibilityLabel:i.translate("payment.credit_card_name_label"),containerId:B("ccName")},cardNumber:{accessibilityLabel:i.translate("payment.credit_card_number_label"),containerId:B("ccNumber")}},styles:c?{default:yield(0,N.A)(c,t),error:yield(0,N.A)(c,t,N.S.Error),focus:yield(0,N.A)(c,t,N.S.Focus)}:{},onBlur:({fieldType:e})=>{u===e&&y(void 0)},onCardTypeChange:({cardType:e})=>{g("hostedForm.cardType",e)},onEnter:()=>{b(!0),f()},onFocus:({fieldType:e})=>{y(e)},onValidate:({errors:e={}})=>{(0,h.forIn)(e,((e,t)=>{const a=`hostedForm.errors.${t}`;g(a,e&&e[0].type?e[0].type:""),e&&e[0]&&p(a)}))}}}))),[u,B,E,C,v,_,i,o,g,p,y,b,f]),R=(0,r.useCallback)((e=>{const t=!!e&&_(e,o),a=!!e&&v(e,o),n=t||a;return r.createElement(P.A,{cardCodeId:a?B("ccCvv"):void 0,cardExpiryId:n?B("ccExpiry"):void 0,cardNumberId:t?B("ccNumber"):void 0,focusedFieldType:u})}),[u,B,v,_,o]),D=t.initializePayment,x=(0,r.useCallback)(((e,t)=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){return D(Object.assign(Object.assign({},e),{bigcommerce_payments_creditcards:{form:m?yield O(t):void 0}}))}))),[O,D]);return m?r.createElement(I.A,Object.assign({},e,{cardFieldset:r.createElement(S.A,{additionalFields:l&&r.createElement(T.A,{name:"ccCustomerCode"}),cardCodeId:E?B("ccCvv"):void 0,cardExpiryId:B("ccExpiry"),cardNameId:B("ccName"),cardNumberId:B("ccNumber"),focusedFieldType:u}),cardValidationSchema:(0,A.A)({language:i}),deinitializePayment:t.deinitializePayment,getHostedFormOptions:O,getStoredCardValidationFieldset:R,initializePayment:x,storedCardValidationSchema:(0,w.A)({language:i,isCardExpiryRequired:!0})})):r.createElement(I.A,Object.assign({},e,{deinitializePayment:t.deinitializePayment,initializePayment:x}))}),[{id:"bigcommerce_payments_creditcards"}]);var O=a(94027),R=a(9343),D=a(56943);const x=({renderPayPalCardComponent:e})=>((0,r.useEffect)((()=>{"function"==typeof e&&e("#big-commerce-payments-fastlane-cc-form-container")}),[e]),r.createElement("div",{className:"big-commerce-payments-fastlane-cc-form-container","data-test":"big-commerce-payments-fastlane-cc-form-container",id:"big-commerce-payments-fastlane-cc-form-container"}));var M=a(49655),z=a(35172),V=a(86516),L=a(63163);const j=({onChange:e,handleSelectInstrument:t,selectedInstrument:a})=>{const n=function(e){switch(e.toLowerCase()){case"amex":case"american_express":return"american-express";case"diners":return"diners-club";case"master_card":return"mastercard";default:return e}}(a.brand).toLowerCase();return r.createElement("div",{className:"big-commerce-payments-fastlane-instrument","data-test":"big-commerce-payments-fastlane-instrument-form"},r.createElement("div",null,r.createElement("div",{className:"big-commerce-payments-fastlane-instrument-details"},r.createElement(V.A,{cardType:n}),r.createElement("div",{className:"instrumentSelect-card","data-test":"big-commerce-fastlane-instrument-last4"},r.createElement("span",null,"●●●● ",a.last4))),r.createElement("div",{className:"big-commerce-payments-fastlane-instrument-branding"},r.createElement(z.A,null))),r.createElement("div",{className:"big-commerce-payments-fastlane-instrument-change-action"},r.createElement(L.Ay,{onClick:()=>(0,d.__awaiter)(void 0,void 0,void 0,(function*(){if("function"==typeof e){const a=yield e();a&&t(a)}})),size:L.Mp.Tiny,testId:"big-commerce-payments-fastlane-instrument-change",variant:L.Ak.Secondary},r.createElement(M.A,{id:"common.change_action"}))))},U=({renderPayPalCardComponent:e,showPayPalCardSelector:t})=>{const{instruments:a,handleSelectInstrument:n,selectedInstrument:i}=(()=>{const[e,t]=(0,r.useState)(),{getPaymentProviderCustomer:a}=(0,b.Q)().checkoutState.data,n=a(),i=(0,D.A)(n)?n:{},{paymentForm:o}=(0,f.N)();return{instruments:i.instruments||[],handleSelectInstrument:e=>{t(e),o.setFieldValue("instrumentId",e.bigpayToken)},selectedInstrument:e}})(),o=a.length>0;return(0,r.useEffect)((()=>{!i&&a.length>0&&n(a[0])}),[a,i,n]),r.createElement("div",{className:"paymentMethod paymentMethod--creditCard"},o&&r.createElement(j,{handleSelectInstrument:n,onChange:t,selectedInstrument:i||a[0]}),!o&&r.createElement(x,{renderPayPalCardComponent:e}))};const q=(0,o.A)((({method:e,checkoutService:t,checkoutState:a,onUnhandledError:n,paymentForm:i,language:o})=>{const c=(0,r.useRef)({}),{isLoadingPaymentMethod:s,isInitializingPayment:m}=a.statuses;(0,r.useEffect)((()=>((0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({methodId:e.id,bigcommerce_payments_fastlane:{onInit:e=>{c.current.renderPayPalCardComponent=e},onChange:e=>{c.current.showPayPalCardSelector=e},onError:e=>{let t;return t=function(e){return"object"==typeof e&&null!==e&&"translationKey"in e}(e)?new Error(o.translate(e.translationKey)):e instanceof Error?e:new Error(o.translate("payment.errors.general_error")),n(t)}}})}catch(e){e instanceof Error&&n(e)}})),()=>{(0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({methodId:e.id})}catch(e){e instanceof Error&&n(e)}}))})),[]);const l=m()||s(e.id),u={isSubmitted:i.isSubmitted(),setSubmitted:i.setSubmitted};return r.createElement(R.Ay.Provider,{value:u},r.createElement(b.A.Provider,{value:{checkoutState:a,checkoutService:t}},r.createElement(O.A,{checkoutService:t},r.createElement(f.i.Provider,{value:{paymentForm:i}},r.createElement(y.A,{hideContentWhenLoading:!0,isLoading:l},r.createElement(U,{renderPayPalCardComponent:c.current.renderPayPalCardComponent,showPayPalCardSelector:c.current.showPayPalCardSelector}))))))}),[{id:"bigcommerce_payments_fastlane"}]),K=(0,o.A)((e=>{const t={onComplete:c.A,onError:e.onUnhandledError};return r.createElement(i.A,Object.assign({additionalInitializationOptions:t,integrations:[n.MF]},e))}),[{id:"bigcommerce_payments_paylater"}]),$=(0,o.A)((e=>{const{checkoutState:t}=e;return t.data.isPaymentDataRequired()?r.createElement(p,Object.assign({providerOptionsKey:"bigcommerce_payments_paylater"},e)):null}),[{id:"bigcommerce_payments_paylater"}]),Y=(0,o.A)((e=>e.checkoutState.data.isPaymentDataRequired()?r.createElement(p,Object.assign({providerOptionsKey:"bigcommerce_payments_venmo"},e)):null),[{id:"bigcommerce_payments_venmo"}]);var H=a(20874),W=a(25657),G=a(33740),J=a(41410),Q=a(44218),X=a(94202);const Z=(0,Q.Bj)((function({formFieldData:e,language:t}){const a={ratepayPhoneCountryCode:"payment.ratepay.phone_country_code",ratepayPhoneNumber:"payment.ratepay.phone_number",ratepayBirthDate:"payment.ratepay.birth_date"};return(0,X.Ik)(e.reduce(((e,{id:n,required:r})=>(r&&a[n]&&(e[n]=(0,X.Yj)().nullable().required(t.translate("payment.ratepay.errors.isRequired",{fieldName:t.translate(a[n])})),"ratepayPhoneCountryCode"===n&&(e[n]=e[n].matches(/^\+\d{2,}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_country_code")}))),"ratepayPhoneNumber"===n&&(e[n]=e[n].matches(/^\d{7,11}$/,t.translate("payment.ratepay.errors.isInvalid",{fieldName:t.translate("payment.ratepay.phone_number")})))),e)),{}))})),ee="ITEM_CATEGORY_NOT_SUPPORTED_BY_PAYMENT_SOURCE",te=[{name:"ratepayBirthDate",custom:!1,id:"ratepayBirthDate",label:"payment.ratepay.birth_date",required:!0,fieldType:G.A.DATE,inputDateFormat:"dd.MM.yyyy"},{name:"ratepayPhoneCountryCode",custom:!1,id:"ratepayPhoneCountryCode",label:"payment.ratepay.phone_country_code",required:!0,fieldType:G.A.TEXT,type:"string"},{name:"ratepayPhoneNumber",custom:!1,id:"ratepayPhoneNumber",label:"payment.ratepay.phone_number",required:!0,fieldType:G.A.TEXT}],ae=(0,o.A)((({method:e,checkoutService:t,onUnhandledError:a,paymentForm:{isSubmitted:n,setFieldValue:i,setValidationSchema:o,setSubmitted:c},language:s,checkoutState:m})=>{const l=(0,r.useRef)({}),u=m.data.isPaymentDataRequired();if(!u)return null;(0,r.useEffect)((()=>((0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,bigcommerce_payments_ratepay:{container:"#checkout-payment-continue",legalTextContainer:"legal-text-container",loadingContainerId:"checkout-page-container",getFieldsValues:()=>l.current,onError:e=>{var t,n;const r=null===(t=e.errors)||void 0===t?void 0:t.filter((e=>e.provider_error));if(null==r?void 0:r.length){let e,t;const i=null===(n=r[0].provider_error)||void 0===n?void 0:n.code;switch(i){case"PAYMENT_SOURCE_DECLINED_BY_PROCESSOR":e="payment.ratepay.errors.paymentSourceDeclinedByProcessor";break;case"PAYMENT_SOURCE_INFO_CANNOT_BE_VERIFIED":e="payment.ratepay.errors.paymentSourceInfoCannotBeVerified";break;case ee:e="payment.ratepay.errors.itemCategoryNotSupportedByPaymentSource";break;default:e="common.error_heading"}return t=i!==ee?new W.A({data:{shouldBeTranslatedAsHtml:!0,translationKey:e}}):new Error(s.translate(e)),a(t)}a(e)}}})}catch(e){e instanceof Error&&a(e)}})),()=>{(0,d.__awaiter)(void 0,void 0,void 0,(function*(){try{yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}catch(e){e instanceof Error&&a(e)}}))})),[]);const y=(0,r.useCallback)((e=>t=>{var a;i(e,t),a={[e]:t},l.current=Object.assign(Object.assign({},l.current),a)}),[i]),p=(0,r.useMemo)((()=>Z({formFieldData:te,language:s})),[s,te]);return(0,r.useEffect)((()=>{c(!1),o(e,p)}),[p,e,o,c]),(0,r.useEffect)((()=>{i("ratepayPhoneCountryCode",(()=>{const e=m.data.getBillingAddress();return(0,H.B)(e.country)[0]||""})().dialCode)}),[]),r.createElement("div",{style:{marginBottom:"20px"}},r.createElement(R.Ay.Provider,{value:{isSubmitted:n,setSubmitted:c}},te.map((e=>r.createElement(J.A,{extraClass:`dynamic-form-field--${e.id}`,field:e,key:e.id,label:s.translate(e.label),onChange:y(e.id)})))))}),[{gateway:"bigcommerce_payments_apms",id:"ratepay"}])}}]);
//# sourceMappingURL=1084-5b92c8c6.js.map