"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[2750],{31698:(e,t,a)=>{a.d(t,{A:()=>m});var n=a(31635),i=a(44218),r=a(69440),s=a(70355),l=a(65685),o=a(94611),u=a(11474),c=a(40646),d=a(91182);const m=e=>{const{description:t,isInitializing:a=!1,initializePayment:m,method:b,onUnhandledError:g=r.noop,deinitializePayment:p}=e,[y,h]=(0,s.useState)(!1),[_,I]=(0,s.useState)(),f=function(e){const t=(0,i.B4)(((e=[])=>e.filter(l.A))),a=(0,i.B4)(((e=[])=>e.filter((({trustedShippingAddress:e})=>e)))),{checkoutService:n,checkoutState:r,isUsingMultiShipping:s=!1,method:u}=e,{data:{getCart:c,getConfig:d,getCustomer:m,getInstruments:b,isPaymentDataRequired:g,isPaymentDataSubmitted:p},statuses:{isLoadingInstruments:y}}=r,h=c(),_=d(),I=m();if(!_||!h||!I)throw new Error("Unable to get checkout");const f=t(b(u)),v=a(f);return{instruments:v,isNewAddress:0===v.length&&f.length>0,isInstrumentFeatureAvailable:!p(u.id,u.gateway)&&(0,o.A)({config:_,customer:I,isUsingMultiShipping:s,paymentMethod:u}),isLoadingInstruments:y(),isPaymentDataRequired:g(),loadInstruments:n.loadInstruments}}(e),{isLoadingInstruments:v,instruments:C,isNewAddress:E,isInstrumentFeatureAvailable:S,loadInstruments:k}=f,w=(0,s.useCallback)((()=>{if(!y&&C.length)return(0,r.find)(C,{defaultInstrument:!0})||C[0]}),[y,C]),A=(0,s.useCallback)((()=>{h(!0),I(void 0)}),[]),N=(0,s.useCallback)((e=>{h(!1),I((0,r.find)(C,{bigpayToken:e}))}),[C]);(0,s.useEffect)((()=>((0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield m({gatewayId:b.gateway,methodId:b.id}),S&&(yield k())}catch(e){g(e)}})),()=>{(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{yield p({gatewayId:b.gateway,methodId:b.id})}catch(e){g(e)}}))})),[]);const P=_||w(),F=a||v,L=S&&(C.length>0||E);return t||S?s.createElement(d.A,{hideContentWhenLoading:!0,isLoading:F},s.createElement("div",{className:"paymentMethod paymentMethod--hosted"},t,L&&s.createElement(u.A,{instruments:C,onSelectInstrument:N,onUseNewInstrument:A,selectedInstrument:P}),S&&s.createElement(c.A,{instrumentId:P&&P.bigpayToken,instruments:C,isAccountInstrument:!0}))):null}},88887:(e,t,a)=>{a.d(t,{BlueSnapDirectAlternativePaymentMethod:()=>F,BlueSnapDirectEcpPaymentMethod:()=>N,BlueSnapDirectIdealPaymentMethod:()=>D,BlueSnapDirectPayByBankPaymentMethod:()=>U,BlueSnapDirectSepaPaymentMethod:()=>O,BlueSnapV2PaymentMethod:()=>V});var n,i=a(31635),r=a(70355),s=a(11474),l=a(40646),o=a(19285),u=a(91182),c=a(24750),d=a(40052),m=a(22292);!function(e){e.ConsumerChecking="CONSUMER_CHECKING",e.ConsumerSavings="CONSUMER_SAVINGS",e.CorporateChecking="CORPORATE_CHECKING",e.CorporateSavings="CORPORATE_SAVINGS"}(n||(n={}));var b=a(18336),g=a(33740),p=a(30680);const y=(0,r.memo)((e=>{var{maxLength:t,useFloatingLabel:a}=e,n=(0,i.__rest)(e,["maxLength","useFloatingLabel"]);const s=(0,r.useCallback)((({field:e})=>r.createElement(b.A,Object.assign({},e,{"aria-labelledby":`${e.name}-label ${e.name}-field-error-message`,autoComplete:"cc-number",fieldType:g.A.TELEPHONE,id:e.name,isFloatingLabelEnabled:a,maxLength:t}))),[t,a]);return r.createElement(p.A,Object.assign({input:s},n))})),h=(0,r.memo)((e=>{var{options:{helperLabel:t,items:a,rows:n},useFloatingLabel:s}=e,l=(0,i.__rest)(e,["options","useFloatingLabel"]);const o=(0,r.useCallback)((({field:e})=>r.createElement(b.A,Object.assign({},e,{"aria-labelledby":`${e.name}-label ${e.name}-field-error-message`,fieldType:g.A.DROPDOWM,id:e.name,isFloatingLabelEnabled:s,options:a,placeholder:t,rows:n}))),[t,a,n,s]);return r.createElement(p.A,Object.assign({},l,{input:o}))})),_=(0,r.memo)((e=>{var{maxLength:t,useFloatingLabel:a,autoComplete:n}=e,s=(0,i.__rest)(e,["maxLength","useFloatingLabel","autoComplete"]);const l=(0,r.useCallback)((({field:e})=>r.createElement(b.A,Object.assign({},e,{"aria-labelledby":`${e.name}-label ${e.name}-field-error-message`,autoComplete:n,id:e.name,isFloatingLabelEnabled:a,maxLength:t}))),[t,a,n]);return r.createElement(p.A,Object.assign({input:l},s))})),I=(0,r.memo)((({language:e,useFloatingLabel:t,shouldRenderCompanyName:a})=>{const i={helperLabel:e.translate("payment.bluesnap_direct_account_type_select.label"),items:[{label:e.translate("payment.bluesnap_direct_account_type_select.option_consumer_checking"),value:n.ConsumerChecking},{label:e.translate("payment.bluesnap_direct_account_type_select.option_consumer_savings"),value:n.ConsumerSavings},{label:e.translate("payment.bluesnap_direct_account_type_select.option_corporate_checking"),value:n.CorporateChecking},{label:e.translate("payment.bluesnap_direct_account_type_select.option_corporate_savings"),value:n.CorporateSavings}]};return r.createElement(r.Fragment,null,r.createElement(y,{labelContent:e.translate("payment.bluesnap_direct_account_number.label"),maxLength:17,name:"accountNumber",useFloatingLabel:t}),r.createElement(y,{labelContent:e.translate("payment.bluesnap_direct_routing_number.label"),maxLength:9,name:"routingNumber",useFloatingLabel:t}),r.createElement(h,{labelContent:e.translate("payment.bluesnap_direct_account_type.label"),name:"accountType",options:i,useFloatingLabel:t}),a&&r.createElement(_,{labelContent:e.translate("address.company_name_label"),name:"companyName",useFloatingLabel:t}))}));var f=a(69440),v=a(48709),C=a(39981),E=a(66960);const S=e=>{const[t,a]=(0,r.useState)(),{checkoutState:n}=(0,C.Q)(),i=n.data.getCustomer(),s=n.data.getInstruments(e),{paymentForm:l}=(0,E.N)(),{setFieldValue:o}=l,u=(0,r.useMemo)((()=>s?s.filter(v.A):[]),[s]),c=!(null==i?void 0:i.isGuest)&&Boolean(e.config.isVaultingEnabled),d=c&&u.length>0,m=d&&!t,b=(0,r.useCallback)((()=>{if(!u.length)return;return u.filter((({defaultInstrument:e})=>e))[0]||u[0]}),[u]);(0,r.useEffect)((()=>{a(c?b():void 0)}),[c,b]),(0,r.useEffect)((()=>{d||o("instrumentId","")}),[o,d]);const g=(0,r.useCallback)((e=>{a((0,f.find)(u,{bigpayToken:e})),o("instrumentId",e),o("shouldSetAsDefaultInstrument",!1)}),[u,o]),p=(0,r.useCallback)((()=>{a(void 0),o("instrumentId",""),o("shouldSaveInstrument",!1),o("shouldSetAsDefaultInstrument",!1)}),[o]);return{accountInstruments:u,currentInstrument:t,handleSelectInstrument:g,handleUseNewInstrument:p,isInstrumentFeatureAvailable:c,shouldShowInstrumentFieldset:d,shouldCreateNewInstrument:m}};var k=a(44218),w=a(94202);const A=(0,k.Bj)((function(e,t,a){const n=Object.assign(Object.assign({},t?{}:{instrumentId:(0,w.Yj)().required()}),t?Object.assign(Object.assign({accountNumber:(0,w.Yj)().required(e.translate("payment.bluesnap_direct_account_number.is_required")).matches(/^\d+$/,e.translate("payment.bluesnap_direct_account_number.only_numbers")).min(4,e.translate("payment.bluesnap_direct_account_number.length")).max(17,e.translate("payment.bluesnap_direct_account_number.length_max")),routingNumber:(0,w.Yj)().required(e.translate("payment.bluesnap_direct_routing_number.is_required")).matches(/^\d+$/,e.translate("payment.bluesnap_direct_routing_number.only_numbers")).length(9,e.translate("payment.bluesnap_direct_routing_number.length"))},a?{companyName:(0,w.Yj)().required(e.translate("address.company_name_required_error")).max(50,e.translate("payment.bluesnap_direct_company_name.length_max"))}:{}),{accountType:(0,w.Yj)().required(e.translate("payment.bluesnap_direct_account_type.is_required"))}):{});return(0,w.Ik)(n)})),N=(0,o.A)((({method:e,checkoutService:{initializePayment:t,deinitializePayment:a,loadInstruments:o},checkoutState:{data:{isPaymentDataRequired:b,getCustomer:g,getBillingAddress:p},statuses:{isLoadingInstruments:y}},paymentForm:{disableSubmit:h,setValidationSchema:_,setFieldValue:f,getFormValues:v},language:C,onUnhandledError:E})=>{const[k,w]=(0,r.useState)(!0),N=(0,r.useCallback)((e=>w(!e)),[w]);(0,r.useEffect)((()=>h(e,b()&&k)),[h,k,b,e]);const P=(0,r.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield t({gatewayId:e.gateway,methodId:e.id})}))),[t,e]),F=(0,r.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield a({gatewayId:e.gateway,methodId:e.id})}))),[a,e.gateway,e.id]);(0,r.useEffect)((()=>(P(),()=>{F()})),[F,P]),(0,r.useEffect)((()=>{const{isGuest:t}=g()||{};!t&&e.config.isVaultingEnabled&&(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield o()}catch(e){e instanceof Error&&E(e)}}))}),[]);const{accountInstruments:L,currentInstrument:j,handleSelectInstrument:z,handleUseNewInstrument:B,isInstrumentFeatureAvailable:O,shouldShowInstrumentFieldset:q,shouldCreateNewInstrument:D}=S(e),R=y(),V=!q||D,M=v().accountType,U=M===n.CorporateChecking||M===n.CorporateSavings;return(0,r.useEffect)((()=>{var e;f("companyName",U?null===(e=p())||void 0===e?void 0:e.company:void 0)}),[U,f,p]),(0,r.useEffect)((()=>{_(e,A(C,V,U))}),[C,V,U,_,e]),r.createElement(u.A,{hideContentWhenLoading:!0,isLoading:R},r.createElement(c.A,{legend:r.createElement(d.A,{hidden:!0},C.translate("payment.bluesnap_direct_electronic_check_label")),style:{paddingBottom:"1rem"}},q&&r.createElement("div",{className:"checkout-ach-form__instrument"},r.createElement(s.A,{instruments:L,onSelectInstrument:z,onUseNewInstrument:B,selectedInstrument:j})),V&&r.createElement(I,{language:C,shouldRenderCompanyName:U}),r.createElement(m.A,{labelContent:C.translate("payment.bluesnap_direct_permission"),name:"shopperPermission",onChange:N}),O&&r.createElement(l.A,{instrumentId:null==j?void 0:j.bigpayToken,instruments:L,isAccountInstrument:!0})))}),[{id:"ecp",gateway:"bluesnapdirect"}]);var P=a(31698);const F=(0,o.A)((e=>{var{checkoutService:t}=e,a=(0,i.__rest)(e,["checkoutService"]);return r.createElement(P.A,Object.assign({},a,{checkoutService:t,deinitializePayment:t.deinitializePayment,initializePayment:t.initializePayment}))}),[{gateway:"bluesnapdirect"}]),L=e=>{return!("object"!=typeof e||null===e||!("sepaCreditorCompanyName"in e&&"string"==typeof e.sepaCreditorCompanyName||"idealIssuers"in e&&(t=e.idealIssuers,Array.isArray(t)&&t.length&&"issuerId"in t[0]&&"issuerName"in t[0])));var t};var j=a(74411);const z=e=>{const[t,a]=(0,r.useState)(),{checkoutState:n}=(0,C.Q)(),i=n.data.getCustomer(),s=n.data.getInstruments(e),{paymentForm:l}=(0,E.N)(),{setFieldValue:o}=l,u=(0,r.useMemo)((()=>s?s.filter(j.P):[]),[s]),c=!(null==i?void 0:i.isGuest)&&Boolean(e.config.isVaultingEnabled),d=c&&u.length>0,m=d&&!t,b=(0,r.useCallback)((()=>{if(!u.length)return;return u.filter((({defaultInstrument:e})=>e))[0]||u[0]}),[u]);(0,r.useEffect)((()=>{a(c?b():void 0)}),[c,b]),(0,r.useEffect)((()=>{d||o("instrumentId","")}),[o,d]);const g=(0,r.useCallback)((e=>{a((0,f.find)(u,{bigpayToken:e})),o("instrumentId",e),o("shouldSetAsDefaultInstrument",!1)}),[u,o]),p=(0,r.useCallback)((()=>{a(void 0),o("instrumentId",""),o("shouldSaveInstrument",!1),o("shouldSetAsDefaultInstrument",!1)}),[o]);return{accountInstruments:u,currentInstrument:t,handleSelectInstrument:g,handleUseNewInstrument:p,isInstrumentFeatureAvailable:c,shouldShowInstrumentFieldset:d,shouldCreateNewInstrument:m}},B=(0,k.Bj)((function(e,t){const a=Object.assign(Object.assign({},t?{}:{instrumentId:(0,w.Yj)().required()}),t?{iban:(0,w.Yj)().matches(/^[a-zA-Z0-9]+$/i,e.translate("address.invalid_characters_error",{label:"IBAN"})).required(e.translate("payment.sepa_account_number_required")),firstName:(0,w.Yj)().required(e.translate("address.first_name_required_error")),lastName:(0,w.Yj)().required(e.translate("address.last_name_required_error"))}:{});return(0,w.Ik)(a)})),O=(0,o.A)((e=>{const{method:t,checkoutService:{initializePayment:a,deinitializePayment:n,loadInstruments:o},checkoutState:{data:{isPaymentDataRequired:b},statuses:{isLoadingInstruments:g}},paymentForm:{disableSubmit:p,setValidationSchema:y},language:h,onUnhandledError:I}=e;if(!L(t.initializationData))throw new Error("Unable to get initialization data");const[f,v]=(0,r.useState)(!0),C=(0,r.useCallback)((e=>v(!e)),[v]);(0,r.useEffect)((()=>p(t,b()&&f)),[p,f,b,t]);const E=(0,r.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield a({gatewayId:t.gateway,methodId:t.id})}))),[a,t]),S=(0,r.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield n({gatewayId:t.gateway,methodId:t.id})}))),[n,t.gateway,t.id]);(0,r.useEffect)((()=>(E(),()=>{S()})),[S,E]);const{accountInstruments:k,currentInstrument:w,handleSelectInstrument:A,handleUseNewInstrument:N,isInstrumentFeatureAvailable:P,shouldShowInstrumentFieldset:F,shouldCreateNewInstrument:j}=z(t),O=!F||j;(0,r.useEffect)((()=>{y(t,B(h,O))}),[h,O,y,t]),(0,r.useEffect)((()=>{P&&(0,i.__awaiter)(void 0,void 0,void 0,(function*(){try{yield o()}catch(e){e instanceof Error&&I(e)}}))}),[]);const q=g();return r.createElement(u.A,{hideContentWhenLoading:!0,isLoading:q},r.createElement(c.A,{legend:r.createElement(d.A,{hidden:!0},h.translate("payment.bluesnap_direct_sepa_direct_debit")),style:{paddingBottom:"1rem"}},F&&r.createElement("div",{className:"checkout-ach-form__instrument"},r.createElement(s.A,{instruments:k,onSelectInstrument:A,onUseNewInstrument:N,selectedInstrument:w})),O&&r.createElement(r.Fragment,null,r.createElement(_,{autoComplete:"iban",labelContent:h.translate("payment.bluesnap_direct_iban.label"),name:"iban",useFloatingLabel:!0}),r.createElement(_,{labelContent:h.translate("address.first_name_label"),name:"firstName",useFloatingLabel:!0}),r.createElement(_,{labelContent:h.translate("address.last_name_label"),name:"lastName",useFloatingLabel:!0})),r.createElement(m.A,{labelContent:h.translate("payment.bluesnap_direct_sepa_mandate_disclaimer",{creditorName:t.initializationData.sepaCreditorCompanyName}),name:"shopperPermission",onChange:C}),P&&r.createElement(l.A,{instrumentId:null==w?void 0:w.bigpayToken,instruments:k,isAccountInstrument:!0})))}),[{id:"sepa_direct_debit",gateway:"bluesnapdirect"}]),q=(0,k.Bj)((function(e){return(0,w.Ik)({bic:(0,w.Yj)().required(e.translate("payment.ideal_bic_required"))})})),D=(0,o.A)((({method:e,checkoutService:{initializePayment:t,deinitializePayment:a},paymentForm:{setValidationSchema:n},language:s})=>{if(!L(e.initializationData))throw new Error("Unable to get initialization data");const{idealIssuers:l}=e.initializationData,o=l.map((e=>({value:e.issuerId,label:e.issuerName}))),u=(0,r.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){n(e,q(s)),yield t({gatewayId:e.gateway,methodId:e.id})}))),[t,e,n,s]),m=(0,r.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield a({gatewayId:e.gateway,methodId:e.id})}))),[a,e.gateway,e.id]);return(0,r.useEffect)((()=>(u(),()=>{m()})),[m,u]),r.createElement(c.A,{legend:r.createElement(d.A,{hidden:!0},s.translate("payment.ideal.label")),style:{paddingBottom:"1rem"}},r.createElement(h,{labelContent:s.translate("payment.ideal.label"),name:"bic",options:{helperLabel:s.translate("payment.select_your_bank"),items:o}}))}),[{id:"ideal",gateway:"bluesnapdirect"}]);var R=a(24391);const V=(0,o.A)((e=>{var{checkoutService:t,checkoutState:a,method:n,paymentForm:s}=e,l=(0,i.__rest)(e,["checkoutService","checkoutState","method","paymentForm"]);const[o,c]=(0,r.useState)(!1),[d,m]=(0,r.useState)(),b=(0,r.useRef)({paymentPageContentRef:(0,r.createRef)()}),g=(0,r.useCallback)((()=>{m(void 0),b.current.cancelBlueSnapV2Payment&&(b.current.cancelBlueSnapV2Payment(),b.current.cancelBlueSnapV2Payment=void 0)}),[]),p=(0,r.useCallback)((e=>t.initializePayment(Object.assign(Object.assign({},e),{bluesnapv2:{onLoad(e,t){m(e),c(!0),b.current.cancelBlueSnapV2Payment=t},style:{border:"1px solid lightgray",height:"60vh",width:"100%"}}}))),[t]),y=(0,r.useCallback)((()=>{b.current.paymentPageContentRef.current&&d&&(d.addEventListener("load",(()=>{c(!1)})),b.current.paymentPageContentRef.current.appendChild(d))}),[d]);return r.createElement(r.Fragment,null,r.createElement(P.A,Object.assign({},l,{checkoutService:t,checkoutState:a,deinitializePayment:t.deinitializePayment,initializePayment:p,method:n,paymentForm:s})),r.createElement(R.A,{additionalModalClassName:"modal--bluesnap",isOpen:!!d,onAfterOpen:y,onRequestClose:g,shouldShowCloseButton:!0},r.createElement(u.A,{isLoading:o},r.createElement("div",{ref:b.current.paymentPageContentRef}))))}),[{gateway:"bluesnapv2"}]),M=(0,k.Bj)((function(e){return(0,w.Ik)({iban:(0,w.Yj)().matches(/^[a-zA-Z0-9]+$/i,e.translate("address.invalid_characters_error",{label:"IBAN"})).required(e.translate("payment.pay_by_bank_iban_required"))})})),U=(0,o.A)((({method:e,language:t,paymentForm:{setValidationSchema:a},checkoutService:{initializePayment:n,deinitializePayment:s}})=>{if(!L(e.initializationData))throw new Error("Unable to get initialization data");const l=(0,r.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){a(e,M(t)),yield n({gatewayId:e.gateway,methodId:e.id})}))),[n,t,e,a]),o=(0,r.useCallback)((()=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){yield s({gatewayId:e.gateway,methodId:e.id})}))),[s,e.gateway,e.id]);return(0,r.useEffect)((()=>(l(),()=>{o()})),[o,l]),r.createElement(c.A,{legend:r.createElement(d.A,{hidden:!0},t.translate("payment.bluesnap_direct_iban.label")),style:{paddingBottom:"1rem"}},r.createElement(_,{autoComplete:"iban",labelContent:t.translate("payment.bluesnap_direct_iban.label"),name:"iban",useFloatingLabel:!0}))}),[{id:"pay_by_bank",gateway:"bluesnapdirect"}])},94611:(e,t,a)=>{function n({config:e,customer:t,isUsingMultiShipping:a,paymentMethod:n}){return!(!e.checkoutSettings.isCardVaultingEnabled||!n.config.isVaultingEnabled||t.isGuest||a)}a.d(t,{A:()=>n})}}]);
//# sourceMappingURL=blue-snap-v2-payment-method-86c51b81.js.map