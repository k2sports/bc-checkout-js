"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[7516],{29905:(e,t,n)=>{function r(e){switch(e){case"amex":case"american_express":return"american-express";case"diners":case"diners_club":return"diners-club";default:return e}}n.d(t,{A:()=>r})},33138:(e,t,n)=>{n.d(t,{SquareV2PaymentMethod:()=>y});var r=n(31635),i=n(69440),s=n(70355),a=n(59713),o=n(19285),d=n(3375),l=n.n(d),c=n(62677),m=n(40646),u=n(66960),p=n(91182);const E=({checkoutService:e,checkoutState:t,containerId:n,deinitializePayment:r,initializePayment:i,method:a})=>{var o;const[d,E]=(0,s.useState)(!1),[y,f]=(0,s.useState)(void 0),{getCustomer:I,getInstruments:b}=t.data,h=!(null===(o=I())||void 0===o?void 0:o.isGuest)&&Boolean(a.config.isVaultingEnabled);(0,s.useEffect)((()=>{h&&e.loadInstruments()}),[e,h]);const g=(0,s.useMemo)((()=>b(a)||[]),[b,a]),v=h&&g.length>0,k=!v||d,C=(0,s.useCallback)((()=>{if(!d&&g.length>0){return(g.find((e=>e.defaultInstrument))||g[0]).bigpayToken}}),[g,d]);(0,s.useEffect)((()=>{const e=C()||void 0;f(e)}),[C,g]);const{setFieldValue:x}=(0,u.N)().paymentForm,{isLoadingInstruments:N}=t.statuses;return s.createElement(p.A,{"data-test":"squarev2_loading_overlay",hideContentWhenLoading:!0,isLoading:N()},s.createElement("div",{className:"paymentMethod--hosted"},v&&s.createElement(c.A,{instruments:g,onDeleteInstrument:e=>{0===g.length?(E(!0),f(void 0),x("instrumentId","")):y===e&&(f(C()),x("instrumentId",C()))},onSelectInstrument:e=>{E(!1),f(e)},onUseNewInstrument:()=>{E(!0),f(void 0),r(),i()},selectedInstrumentId:y||C()}),s.createElement("div",{className:l()("widget",`widget--${a.id}`,"payment-widget"),"data-test":n,style:{display:k?void 0:"none"},tabIndex:-1},s.createElement("div",{"data-test":"squarev2_placeholder_form",style:{display:"none"}},s.createElement("div",{className:"form-field"},s.createElement("div",{className:"form-label optimizedCheckout-form-label",id:"messageIsDefault"}),s.createElement("div",{className:"form-input optimizedCheckout-form-input",id:"inputIsDefault"})),s.createElement("div",{className:"form-field"},s.createElement("div",{className:"form-input optimizedCheckout-form-input form-input--focus optimizedCheckout-form-input--focus",id:"inputIsFocus"})),s.createElement("div",{className:"form-field form-field--error"},s.createElement("div",{className:"form-inlineMessage",id:"messageIsError"}),s.createElement("div",{className:"form-input optimizedCheckout-form-input",id:"inputIsError"}))),s.createElement("div",{id:n})),h&&s.createElement(m.A,{instrumentId:y,instruments:g})))},y=(0,o.A)((({method:e,checkoutService:t,checkoutState:n})=>{const o=(e,t)=>{const n=document.querySelector(`#${e}`);if(!n)throw new Error(`Unable to retrieve input styles as the provided container ID "${e}" is not valid.`);return(0,a.A)(n,t)},d=(0,s.useCallback)((()=>{const e=["backgroundColor","borderColor","borderRadius","borderWidth","color","fontSize","fontWeight"];return{default:{message:o("messageIsDefault",["color"]),input:o("inputIsDefault",e)},focus:{input:o("inputIsFocus",(0,i.difference)(e,["borderRadius"]))},error:{message:o("messageIsError",["color"]),input:o("inputIsError",["borderColor","borderWidth","color"])}}}),[]),l=(0,s.useCallback)((e=>{const t=e.default.input,{borderColor:n,borderRadius:i,borderWidth:s}=t,a=(0,r.__rest)(t,["borderColor","borderRadius","borderWidth"]),o=e.focus.input,{borderColor:d,borderWidth:l}=o,c=(0,r.__rest)(o,["borderColor","borderWidth"]),{borderColor:m,borderWidth:u,color:p}=e.error.input;return{input:a,"input.is-focus":Object.assign({},c),"input.is-error":{color:p},".input-container":{borderColor:n,borderRadius:i,borderWidth:s},".input-container.is-focus":{borderColor:d,borderWidth:l},".input-container.is-error":{borderColor:m,borderWidth:u},".message-text":{color:e.default.message.color},".message-icon":{color:e.default.message.color},".message-text.is-error":{color:e.error.message.color},".message-icon.is-error":{color:e.error.message.color}}}),[]),c="squarev2_payment_element_container",m=(0,s.useCallback)((()=>(0,r.__awaiter)(void 0,void 0,void 0,(function*(){let n;try{n=l(d())}catch(e){}yield t.initializePayment({gatewayId:e.gateway,methodId:e.id,squarev2:{containerId:c,style:n}})}))),[t,d,l,e.gateway,e.id]),u=(0,s.useCallback)((()=>(0,r.__awaiter)(void 0,void 0,void 0,(function*(){yield t.deinitializePayment({gatewayId:e.gateway,methodId:e.id})}))),[t,e.gateway,e.id]);return(0,s.useEffect)((()=>(m(),()=>{u()})),[u,m]),s.createElement(E,{checkoutService:t,checkoutState:n,containerId:c,deinitializePayment:u,initializePayment:m,method:e})}),[{id:"squarev2"}])},62677:(e,t,n)=>{n.d(t,{A:()=>N});var r=n(70355),i=n(49655),s=n(24750),a=n(40052),o=n(35393),d=n(97834),l=n(22437),c=n(3375),m=n.n(c),u=n(52921),p=n.n(u),E=n(69440),y=n(86516),f=n(47237),I=n(29905);const b=({className:e,instrument:t,testId:n,shouldHideExpiryDate:s=!1,onClick:a})=>{var o;const d=(0,I.A)(t.brand),c=p().getTypeInfo(d),u=!(0,l.expirationDate)({month:t.expiryMonth,year:t.expiryYear}).isValid;return r.createElement("button",{className:e,"data-test":n,onClick:a,type:"button"},r.createElement("div",{className:m()("instrumentSelect-details",{"instrumentSelect-details--expired":u})},r.createElement(y.A,{cardType:d}),r.createElement("div",{className:"instrumentSelect-card","data-test":`${null!=n?n:""}-last4`},c?r.createElement(i.A,{data:{cardTitle:null!==(o=c.niceType)&&void 0!==o?o:"",endingIn:t.last4},id:"payment.instrument_ending_in_text"}):r.createElement(i.A,{data:{endingIn:t.last4},id:"payment.instrument_default_ending_in_text"})),!s&&r.createElement("div",{className:m()("instrumentSelect-expiry",{"instrumentSelect-expiry--expired":u}),"data-test":`${n||""}-expiry`},u?r.createElement(i.A,{data:{expiryDate:`${t.expiryMonth}/${t.expiryYear}`},id:"payment.instrument_expired_text"}):r.createElement(i.A,{data:{expiryDate:`${t.expiryMonth}/${t.expiryYear}`},id:"payment.instrument_expires_text"}))))},h=({instrument:e,shouldHideExpiryDate:t=!1,onClick:n=E.noop})=>{const i=(0,r.useCallback)((()=>{n(e.bigpayToken)}),[n,e]);return r.createElement(b,{instrument:e,onClick:i,shouldHideExpiryDate:t,testId:"instrument-select-option"})},g=({className:e,testId:t,onClick:n=E.noop})=>r.createElement("button",{className:e,"data-test":t,onClick:n,type:"button"},r.createElement("div",{className:"instrumentSelect-details instrumentSelect-details--addNew"},r.createElement(y.A,null),r.createElement("div",{className:"instrumentSelect-card"},r.createElement(i.A,{id:"payment.instrument_add_card_action"})))),v=({instruments:e,selectedInstrumentId:t,shouldHideExpiryDate:n=!1,onSelectInstrument:i,onUseNewInstrument:s})=>r.createElement("ul",{className:"instrumentSelect-dropdownMenu instrumentSelect-dropdownMenuNext dropdown-menu","data-test":"instrument-select-menu"},e.map((e=>r.createElement("li",{className:m()("instrumentSelect-option dropdown-menu-item",{"instrumentSelect-option--selected":e.bigpayToken===t}),key:e.bigpayToken},r.createElement(h,{instrument:e,onClick:i,shouldHideExpiryDate:n,testId:"instrument-select-option"})))),r.createElement("li",{className:"instrumentSelect-option instrumentSelect-option--addNew dropdown-menu-item"},r.createElement(g,{onClick:s,testId:"instrument-select-option-use-new"}))),k=({instrument:e,shouldHideExpiryDate:t=!1,testId:n,onClick:i})=>e?r.createElement(b,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",instrument:e,onClick:i,shouldHideExpiryDate:t,testId:n}):r.createElement(g,{className:"instrumentSelect-button optimizedCheckout-form-select dropdown-button form-input",testId:n}),C=({field:e,form:t,instruments:n,onSelectInstrument:i,onUseNewInstrument:s,selectedInstrumentId:a,shouldHideExpiryDate:o=!1})=>{const d=(0,r.useRef)(a),l=(0,r.useCallback)(((n="")=>{t.setFieldValue(e.name,n)}),[t,e.name]);(0,r.useEffect)((()=>(setTimeout((()=>l(a))),()=>{""===e.value&&void 0!==a&&l()})),[]),(0,r.useEffect)((()=>{d.current!==a&&setTimeout((()=>l(a))),d.current=a}),[a,l]);const c=(0,E.find)(n,{bigpayToken:a});return r.createElement("div",{className:"instrumentSelect"},r.createElement(f.A,{dropdown:r.createElement(v,{instruments:n,onSelectInstrument:i,onUseNewInstrument:s,selectedInstrumentId:a,shouldHideExpiryDate:o})},r.createElement(k,{instrument:c,shouldHideExpiryDate:o,testId:"instrument-select"}),r.createElement("input",Object.assign({type:"hidden"},e))))};var x=n(3701);const N=(0,r.memo)((({instruments:e,onDeleteInstrument:t,onSelectInstrument:n,onUseNewInstrument:l,selectedInstrumentId:c,shouldHideExpiryDate:m=!1,validateInstrument:u=null})=>{const p=(0,r.useCallback)((t=>r.createElement(C,Object.assign({},t,{instruments:e,onSelectInstrument:n,onUseNewInstrument:l,selectedInstrumentId:c,shouldHideExpiryDate:m}))),[e,n,l,c,m]),E=(0,r.useCallback)((n=>r.createElement(x.A,Object.assign({instruments:e,onDeleteInstrument:t},n))),[e,t]);return r.createElement(s.A,{additionalClassName:"instrumentFieldset",legend:r.createElement(a.A,{hidden:!0},r.createElement(i.A,{id:"payment.instrument_text"}))},r.createElement(o.A,{modal:E},(({onClick:e})=>r.createElement("button",{className:"instrumentModal-trigger",onClick:e,type:"button"},r.createElement(i.A,{id:"payment.instrument_manage_button"})))),r.createElement(d.A,{name:"instrumentId",render:p}),r.createElement("div",{style:{display:c?void 0:"none"}},u))}))}}]);
//# sourceMappingURL=square-v2-payment-method-58c5bdd5.js.map